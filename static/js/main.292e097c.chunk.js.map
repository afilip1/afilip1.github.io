{"version":3,"sources":["util.ts","hooks/game.ts","hooks/grid.ts","components/controlpanel.tsx","components/cell.tsx","components/board.tsx","components/game.tsx","index.tsx"],"names":["Array","prototype","equals","other","this","length","every","element","index","shuffle","i","j","Math","floor","random","zip","map","e","withIndex","from","entries","countBy","predicate","filter","GameState","range","start","end","v","k","useGame","initSize","initMineCount","useState","gridSize","setGridSize","getNeighbors","useCallback","cellIndex","x","y","useGrid","mineCount","setMineCount","firstClick","setFirstClick","mines","setMines","adjacent","setAdjacent","fill","revealed","setRevealed","flagged","setFlagged","populateBoard","firstClickedCell","splice","cell","n","getGameState","emptyCells","isMine","flaggedAllMines","Won","some","isRevealed","Lost","InProgress","handleCellClick","revealCascade","nextRevealed","slice","queue","forEach","center","shift","unrevealed","u","push","revealAllMines","neighbors","unflaggedNeighbors","revealUnflaggedNeighbors","nextFlagged","revealCell","flagCell","board","resetBoard","size","handleCellRightClick","event","preventDefault","GameStatus","status","gameState","minesLeft","ControlPanel","props","settingsChanged","setSettingsChanged","className","onSubmit","onSettingsUpdate","autoComplete","name","type","value","onChange","currentTarget","Cell","onClick","onRightClick","children","onContextMenu","CellHidden","isFlagged","CellRevealed","adjacentCount","countColors","undefined","style","color","Board","cellIds","rows","rowId","key","cellId","renderCell","Game","useCookies","cookies","setCookie","Boolean","newGridSize","newMineCount","Root","CookiesProvider","ReactDOM","render","document","getElementById"],"mappings":"8OAYAA,MAAMC,UAAUC,OAAS,SAAwBC,GAC9C,OAAQC,KAAKC,SAAWF,EAAME,QAAWD,KAAKE,OAAM,SAACC,EAASC,GAAV,OAAoBD,IAAYJ,EAAMK,OAG7FR,MAAMC,UAAUQ,QAAU,WACvB,IAAK,IAAIC,EAAIN,KAAKC,OAAS,EAAGK,EAAI,EAAGA,IAAK,CACvC,IAAMC,EAAIC,KAAKC,MAAMD,KAAKE,UAAYJ,EAAI,IADH,EAElB,CAACN,KAAKO,GAAIP,KAAKM,IAAnCN,KAAKM,GAFiC,KAE7BN,KAAKO,GAFwB,KAI1C,OAAOP,MAGVJ,MAAMC,UAAUc,IAAM,SAA2BZ,GAC9C,OAAOC,KAAKY,KAAI,SAACC,EAAGP,GAAJ,MAAU,CAACO,EAAGd,EAAMO,QAGvCV,MAAMC,UAAUiB,UAAY,WACzB,OAAOlB,MAAMmB,KAAKf,KAAKgB,YAG1BpB,MAAMC,UAAUoB,QAAU,SAAwBC,GAC/C,OAAOlB,KAAKmB,OAAOD,GAAWjB,QAGjC,IC1BYmB,ED0BNC,EAAQ,SAAUC,EAAeC,GACpC,OAAO3B,MAAMmB,KAAK,CAAEd,OAAQsB,EAAMD,IAAS,SAACE,EAAGC,GAAJ,OAAUA,EAAIH,M,OChBrD,SAASI,EAAT,GAAgE,IAA7CC,EAA4C,EAA5CA,SAAUC,EAAkC,EAAlCA,cAAkC,ECnB/D,SAAiBD,GAAmB,IAAD,EACPE,mBAASF,GADF,mBAChCG,EADgC,KACtBC,EADsB,KAGjCC,EACHC,uBAAY,SAACC,GACV,IACG9B,EAFqB,EAEZ,EAATA,EAQ0B8B,GARRJ,EAAUtB,KAAKC,MAAML,EAAQ0B,IAF1B,mBAUjBK,EAViB,KAUdC,EAVc,KAiBxB,MANsC,CACnC,CAACD,EAAI,EAAGC,EAAI,GAAI,CAACD,EAAGC,EAAI,GAAI,CAACD,EAAI,EAAGC,EAAI,GACxC,CAACD,EAAI,EAAGC,GAAwB,CAACD,EAAI,EAAGC,GACxC,CAACD,EAAI,EAAGC,EAAI,GAAI,CAACD,EAAGC,EAAI,GAAI,CAACD,EAAI,EAAGC,EAAI,IAIvCjB,QAXe,SAAC,GAAD,uBAAEgB,EAAF,KAAKC,EAAL,YAChBD,GAAK,GAAKA,EAAIL,GAAYM,GAAK,GAAKA,EAAIN,KAWvClB,KAdD,SAAC,GAAD,uBAAEuB,EAAF,iBAAgBL,EAAWK,OAe9B,CAACL,IAEP,MAAO,CACJA,WACAC,cACAC,gBDT6CK,CAAQV,GAAhDG,EAD2D,EAC3DA,SAAUC,EADiD,EACjDA,YAAaC,EADoC,EACpCA,aADoC,EAGjCH,mBAASD,GAHwB,mBAG5DU,EAH4D,KAGjDC,EAHiD,OAK/BV,mBAAwB,MALO,mBAK5DW,EAL4D,KAKhDC,EALgD,OAOzCZ,mBAAoB,IAPqB,mBAO5Da,EAP4D,KAOrDC,EAPqD,OAQnCd,mBAA4B,IARO,mBAQ5De,EAR4D,KAQlDC,EARkD,OASnChB,mBAASjC,MAAMkC,EAAWA,GAAUgB,MAAK,IATN,mBAS5DC,EAT4D,KASlDC,EATkD,OAUrCnB,mBAASjC,MAAMkC,EAAWA,GAAUgB,MAAK,IAVJ,mBAU5DG,EAV4D,KAUnDC,EAVmD,KAsB7DC,EAAgBlB,uBAAY,SAACmB,GAChC,IAAMV,EAAQ9C,MAAOkC,EAAWA,EAAY,GACxCgB,MAAK,EAAM,EAAGR,GACdQ,MAAK,EAAOR,GACZjC,UAEJqC,EAAMW,OAAOD,EAAkB,GAAG,GAElC,IAAMR,EAAWF,EAAM5B,YAAYF,KAAI,mCAAE0C,EAAF,iBAE/B,KACAtB,EAAasB,GAAMrC,SAAQ,SAACsC,GAAD,OAAOb,EAAMa,SAGhDZ,EAASD,GACTG,EAAYD,KACZ,CAACd,EAAUQ,EAAWN,IAEnBwB,EAAevB,uBAAY,WAC9B,IAAMwB,EAAaf,EAAM9B,KAAI,SAAA8C,GAAM,OAAKA,KAClCC,EAAkBjB,EAAM5C,OAAOmD,GAErC,OAAIF,EAASjD,OAAO2D,IAAeE,EACzBvC,EAAUwC,IAGCb,EAASpC,IAAI+B,GAAOmB,MAAK,mCAAEC,EAAF,KAAcJ,EAAd,YAA0BI,GAAcJ,KAE5EtC,EAAU2C,KAGb3C,EAAU4C,aACjB,CAACtB,EAAOO,EAASF,IAEdkB,EAAkBhC,uBAAY,SAACqB,GAClC,GAAIE,MAAmBpC,EAAU4C,WAAjC,CAEA,GAAqB,IAAjBtB,EAAMzC,OAGP,OAFAkD,EAAcG,QACdb,EAAca,GAIjB,IAQMY,EAAgB,WAAwB,IAC3C,IAAIC,EAAepB,EAASqB,QADe,mBAApBC,EAAoB,yBAApBA,EAAoB,gBAI3C,IAFAA,EAAMC,SAAQ,SAAAhB,GAAI,OAAIa,EAAab,IAAQ,KAEpCe,EAAMpE,OAAS,GAAG,CACtB,IAAMsE,EAASF,EAAMG,QAErB,GAAyB,IAArB5B,EAAS2B,GAAe,CACzB,IAAME,EAAazC,EAAauC,GAAQpD,QAAO,SAAAoC,GAAC,OAAKY,EAAaZ,MAClEkB,EAAWH,SAAQ,SAAAI,GAAC,OAAIP,EAAaO,IAAK,KAC1CL,EAAMM,KAAN,MAAAN,EAAK,YAASI,KAIpB,OAAON,GAwBNlB,EAAQK,KAERZ,EAAMY,GAhDa,WACpB,IAAMa,EAAepB,EACjBpC,IAAI+B,GACJ9B,KAAI,mCAAEkD,EAAF,KAAcJ,EAAd,YAA0BI,GAAcJ,KAEhDV,EAAYmB,GA4CZS,GACQ7B,EAASO,GAzBa,SAACA,GAC/B,IAAMuB,EAAY7C,EAAasB,GAG/B,GADsBuB,EAAU1D,QAAO,SAAAoC,GAAC,OAAIN,EAAQM,MAClCtD,SAAW2C,EAASU,GAAtC,CAEA,IAAMwB,EAAqBD,EAAU1D,QAAO,SAAAoC,GAAC,QAAMR,EAASQ,IAAMN,EAAQM,OAE1EP,EAAYkB,EAAa,WAAb,cAAiBY,MAkB7BC,CAAyBzB,GAfT,SAACA,GACjB,IAAMa,EAAeD,EAAcZ,GAC7B0B,EAAc/B,EAAQmB,QAE5BY,EAAY1B,IAAQ,EAEpBN,EAAYmB,GACZjB,EAAW8B,GAUXC,CAAW3B,OAEd,CAACZ,EAAOK,EAAUE,EAASL,EAAUY,EAAcxB,EAAcmB,IAEhEX,IACDyB,EAAgBzB,GAChBC,EAAc,OAGjB,IAAMyC,EAAW,SAAC5B,GACf,IAAI0B,EAAc/B,EAAQmB,QAC1BY,EAAY1B,IAAS0B,EAAY1B,GACjCJ,EAAW8B,IAUd,MAAO,CACJlD,WACAQ,YACAC,eACA4C,MAAO,CAAEzC,QAAOK,WAAUE,UAASL,YACnCwC,WArIgB,SAACC,EAAc/C,GAC/BP,EAAYsD,GACZ9C,EAAaD,GAEbK,EAAS,IACTE,EAAY,IACZG,EAAYpD,MAAMyF,EAAOA,GAAMvC,MAAK,IACpCI,EAAWtD,MAAMyF,EAAOA,GAAMvC,MAAK,KA+HnCmB,kBACAqB,qBAd0B,SAACC,EAAuBjC,GAClDiC,EAAMC,iBACFhC,MAAmBpC,EAAU4C,YAEjCkB,EAAS5B,IAWT4B,WACA1B,gBElKN,SAASiC,EAAT,GAAgE,IACzDC,EADeC,EAAyC,EAAzCA,UAAWC,EAA8B,EAA9BA,UAE9B,OAAQD,GACL,KAAKvE,EAAU4C,WACZ0B,EAAS,eAAiBE,EAC1B,MACH,KAAKxE,EAAUwC,IACZ8B,EAAS,WACT,MACH,KAAKtE,EAAU2C,KACZ2B,EAAS,cAIf,OAAO,4BAAKA,GASR,SAASG,EAAaC,GAA2B,IAAD,EACpBjE,mBAASiE,EAAMhE,UADK,mBAC7CA,EAD6C,KACnCC,EADmC,OAElBF,mBAASiE,EAAMxD,WAFG,mBAE7CA,EAF6C,KAElCC,EAFkC,OAGNV,oBAAS,GAHH,mBAG7CkE,EAH6C,KAG5BC,EAH4B,KAqBpD,OACG,yBAAKC,UAAU,iBACZ,wCAEA,kBAACR,EAAD,CAAYE,UAAWG,EAAMH,UAAWC,UAAWE,EAAMF,YAEzD,0BAAMM,SAZS,SAACX,GACnBA,EAAMC,iBACNM,EAAMK,iBAAiBrE,EAAUQ,GACjC0D,GAAmB,IAScI,aAAa,OACxC,2CAEG,2BAAOC,KAAK,WAAWC,KAAK,OAAOC,MAAOzE,EAAU0E,SAzBnC,SAACjB,GAC3BxD,GAAawD,EAAMkB,cAAcF,OACjCP,GAAmB,OA0Bb,4CAEG,2BAAOK,KAAK,YAAYC,KAAK,OAAOC,MAAOjE,EAAWkE,SAzBpC,SAACjB,GAC5BhD,GAAcgD,EAAMkB,cAAcF,OAClCP,GAAmB,OAyBb,4BAAQM,KAAK,UAAUP,EAAkB,oBAAsB,YAGlE,yBAAKE,UAAU,SACZ,6BACG,qCACA,2GACA,4GACA,oEACA,uGAGH,6BACG,wCACA,2BAAG,8CAAH,wCACA,2BAAG,+CAAH,gDAEA,2BAAG,2CAAH,yHACA,2BAAG,2CAAH,4F,SF5EH7E,O,2BAAAA,I,aAAAA,I,gBAAAA,M,iBGDZ,SAASsF,EAAT,GAA2E,IAA3D5C,EAA0D,EAA1DA,WAAY6C,EAA8C,EAA9CA,QAASC,EAAqC,EAArCA,aAAcC,EAAuB,EAAvBA,SAC5CZ,EAAY,OAGhB,OAFInC,IAAYmC,GAAa,kBAG1B,4BACGA,UAAWA,EACXU,QAASA,EACTG,cAAeF,GAEdC,GAWV,SAASE,EAAT,GAA4E,IAAtDC,EAAqD,EAArDA,UAAWL,EAA0C,EAA1CA,QAASC,EAAiC,EAAjCA,aACvC,OACG,kBAACF,EAAD,CACG5C,YAAY,EACZ6C,QAASA,EACTC,aAAcA,GAEbI,GAAa,gBAWvB,SAASC,EAAT,GAA8E,IAAtDvD,EAAqD,EAArDA,OAAQwD,EAA6C,EAA7CA,cAAeP,EAA8B,EAA9BA,QACtCQ,EAAc,MAACC,EAAW,OAAQ,QAAS,MAAO,SAAU,SAAU,YAAa,QAAS,QAElG,OACG,kBAACV,EAAD,CACG5C,YAAY,EACZ6C,QAASA,EACTC,aAAc,SAAC/F,GAAD,OAAOA,EAAE2E,mBAEtB9B,GAAU,eACQ,OAAlBwD,GAA0BA,EAAgB,GACxC,0BAAMG,MAAO,CAAEC,MAAOH,EAAYD,KAAmBA,ICnB1D,SAASK,EAAT,GAAgD,IAA/BlC,EAA8B,EAA9BA,KAASS,EAAqB,wBAC/C0B,EAAUnG,EAAM,EAAGgE,EAAOA,GAG1BoC,EAFSpG,EAAM,EAAGgE,GAEJzE,KAAI,SAAA8G,GAAK,OACxB,yBAAKzB,UAAU,YAAY0B,IAAKD,GAE1BF,EACIpD,MAAMsD,EAAQrC,GAAOqC,EAAQ,GAAKrC,GAClCzE,KAAI,SAAAgH,GAAM,OAtC1B,SAAoB9B,EAAwB8B,GAAiB,IAAD,EAIrD9B,EAFDX,MAASzC,EAF6C,EAE7CA,MAAOO,EAFsC,EAEtCA,QAASF,EAF6B,EAE7BA,SAAUH,EAFmB,EAEnBA,SACnC+D,EACCb,EADDa,QAASC,EACRd,EADQc,aAGZ,OAAI7D,EAAS6E,GAEP,kBAACX,EAAD,CACGU,IAAKC,EACLlE,OAAQhB,EAAMkF,GACdjB,QAAS,kBAAMA,EAAQiB,IACvBV,cAAetE,EAASgF,KAK3B,kBAACb,EAAD,CACGY,IAAKC,EACLZ,UAAW/D,EAAQ2E,GACnBjB,QAAS,kBAAMA,EAAQiB,IACvBhB,aAAc,SAAC/F,GAAD,OAAO+F,EAAa/F,EAAG+G,MAiBnBC,CAAW/B,EAAO8B,UAK7C,OAAO,yBAAK3B,UAAU,SAASwB,GC9C3B,SAASK,IAAQ,IAAD,MACSC,YAAW,CAAC,aADrB,mBACbC,EADa,KACJC,EADI,OAchBvG,EAAQ,CAAEC,SAXA,UAAGqG,EAAQ3C,YAAX,QAAmB,EAWTzD,cAVL,UAAGoG,EAAQ1F,iBAAX,QAAwB,KAGxCR,EAPiB,EAOjBA,SACAQ,EARiB,EAQjBA,UACA6C,EATiB,EASjBA,MACAC,EAViB,EAUjBA,WACAnB,EAXiB,EAWjBA,gBACAqB,EAZiB,EAYjBA,qBACA9B,EAbiB,EAajBA,aASH,OACG,yBAAKyC,UAAU,OAAOa,cAAe,SAACjG,GAAD,OAAOA,EAAE2E,mBAC3C,kBAACK,EAAD,CACG/D,SAAUA,EACVQ,UAAWA,EACXqD,UAAWnC,IACXoC,UAAWtD,EAAY6C,EAAMlC,QAAQhC,QAAQiH,SAC7C/B,iBAboB,SAACgC,EAAqBC,GAChDH,EAAU,OAAQE,GAClBF,EAAU,YAAaG,GACvBhD,EAAW+C,EAAaC,MAarB,kBAACb,EAAD,CACGlC,KAAMvD,EACNqD,MAAOA,EACPwB,QAAS1C,EACT2C,aAActB,KCpC1B,SAAS+C,IACN,OACG,kBAACC,EAAA,EAAD,KACG,kBAACR,EAAD,OAKTS,IAASC,OACN,kBAACH,EAAD,MACAI,SAASC,eAAe,W","file":"static/js/main.292e097c.chunk.js","sourcesContent":["/* eslint no-extend-native: [\"error\", { \"exceptions\": [\"Array\"]}] */\r\ndeclare global {\r\n   interface Array<T> {\r\n      equals(other: T[]): boolean\r\n      shuffle(): T[]\r\n      zip<U>(other: U[]): [T, U][]\r\n      withIndex(): [number, T][]\r\n      countBy(predicate: (value: T) => boolean): number\r\n   }\r\n}\r\n\r\n// unbelievable that I have to write this\r\nArray.prototype.equals = function <T>(this: T[], other: T[]) {\r\n   return (this.length === other.length) && this.every((element, index) => element === other[index]);\r\n}\r\n\r\nArray.prototype.shuffle = function <T>(this: T[]) {\r\n   for (let i = this.length - 1; i > 0; i--) {\r\n      const j = Math.floor(Math.random() * (i + 1));\r\n      [this[i], this[j]] = [this[j], this[i]];\r\n   }\r\n   return this;\r\n}\r\n\r\nArray.prototype.zip = function <T, U>(this: T[], other: U[]) {\r\n   return this.map((e, i) => [e, other[i]]);\r\n}\r\n\r\nArray.prototype.withIndex = function <T>(this: T[]) {\r\n   return Array.from(this.entries());\r\n}\r\n\r\nArray.prototype.countBy = function <T>(this: T[], predicate: (item: T) => boolean) {\r\n   return this.filter(predicate).length;\r\n}\r\n\r\nconst range = function (start: number, end: number) {\r\n   return Array.from({ length: end - start }, (v, k) => k + start);\r\n}\r\n\r\nexport { range };","import { useState, SyntheticEvent, useCallback } from \"react\";\r\nimport { useGrid } from \"src/hooks/grid\"\r\n\r\nexport type BoardState = {\r\n   mines: boolean[],\r\n   revealed: boolean[],\r\n   flagged: boolean[],\r\n   adjacent: (number | null)[]\r\n};\r\n\r\nexport enum GameState {\r\n   InProgress,\r\n   Won,\r\n   Lost,\r\n}\r\n\r\ntype InitBoardParams = {\r\n   initSize: number,\r\n   initMineCount: number,\r\n};\r\n\r\nexport function useGame({ initSize, initMineCount }: InitBoardParams) {\r\n   const { gridSize, setGridSize, getNeighbors } = useGrid(initSize);\r\n\r\n   const [mineCount, setMineCount] = useState(initMineCount);\r\n\r\n   const [firstClick, setFirstClick] = useState<number | null>(null);\r\n\r\n   const [mines, setMines] = useState<boolean[]>([]);\r\n   const [adjacent, setAdjacent] = useState<(number | null)[]>([]);\r\n   const [revealed, setRevealed] = useState(Array(gridSize * gridSize).fill(false));\r\n   const [flagged, setFlagged] = useState(Array(gridSize * gridSize).fill(false));\r\n\r\n   const resetBoard = (size: number, mineCount: number) => {\r\n      setGridSize(size);\r\n      setMineCount(mineCount);\r\n\r\n      setMines([]);\r\n      setAdjacent([]);\r\n      setRevealed(Array(size * size).fill(false));\r\n      setFlagged(Array(size * size).fill(false));\r\n   }\r\n\r\n   const populateBoard = useCallback((firstClickedCell: number) => {\r\n      const mines = Array((gridSize * gridSize) - 1)\r\n         .fill(true, 0, mineCount)\r\n         .fill(false, mineCount)\r\n         .shuffle();\r\n\r\n      mines.splice(firstClickedCell, 0, false); // make sure first clicked cell is never a mine\r\n\r\n      const adjacent = mines.withIndex().map(([cell, mine]) =>\r\n         mine\r\n            ? null\r\n            : getNeighbors(cell).countBy((n) => mines[n])\r\n      );\r\n\r\n      setMines(mines);\r\n      setAdjacent(adjacent);\r\n   }, [gridSize, mineCount, getNeighbors]);\r\n\r\n   const getGameState = useCallback(() => {\r\n      const emptyCells = mines.map(isMine => !isMine);\r\n      const flaggedAllMines = mines.equals(flagged);\r\n\r\n      if (revealed.equals(emptyCells) && flaggedAllMines) {\r\n         return GameState.Won;\r\n      }\r\n\r\n      const mineRevealed = revealed.zip(mines).some(([isRevealed, isMine]) => isRevealed && isMine)\r\n      if (mineRevealed) {\r\n         return GameState.Lost;\r\n      }\r\n\r\n      return GameState.InProgress;\r\n   }, [mines, flagged, revealed]);\r\n\r\n   const handleCellClick = useCallback((cell: number) => {\r\n      if (getGameState() !== GameState.InProgress) return;\r\n\r\n      if (mines.length === 0) {\r\n         populateBoard(cell);\r\n         setFirstClick(cell);\r\n         return;\r\n      }\r\n\r\n      const revealAllMines = () => {\r\n         const nextRevealed = revealed\r\n            .zip(mines)\r\n            .map(([isRevealed, isMine]) => isRevealed || isMine);\r\n\r\n         setRevealed(nextRevealed);\r\n      }\r\n\r\n      const revealCascade = (...queue: number[]) => {\r\n         let nextRevealed = revealed.slice()\r\n         queue.forEach(cell => nextRevealed[cell] = true);\r\n\r\n         while (queue.length > 0) {\r\n            const center = queue.shift() as number;\r\n\r\n            if (adjacent[center] === 0) {\r\n               const unrevealed = getNeighbors(center).filter(n => !nextRevealed[n]);\r\n               unrevealed.forEach(u => nextRevealed[u] = true);\r\n               queue.push(...unrevealed);\r\n            }\r\n         }\r\n\r\n         return nextRevealed;\r\n      }\r\n\r\n      const revealUnflaggedNeighbors = (cell: number) => {\r\n         const neighbors = getNeighbors(cell);\r\n\r\n         const adjacentFlags = neighbors.filter(n => flagged[n])\r\n         if (adjacentFlags.length !== adjacent[cell]) return;\r\n\r\n         const unflaggedNeighbors = neighbors.filter(n => !(revealed[n] || flagged[n]));\r\n\r\n         setRevealed(revealCascade(...unflaggedNeighbors));\r\n      }\r\n\r\n      const revealCell = (cell: number) => {\r\n         const nextRevealed = revealCascade(cell);\r\n         const nextFlagged = flagged.slice();\r\n\r\n         nextFlagged[cell] = false;\r\n\r\n         setRevealed(nextRevealed);\r\n         setFlagged(nextFlagged);\r\n      }\r\n\r\n      if (flagged[cell]) return;\r\n\r\n      if (mines[cell]) {\r\n         revealAllMines();\r\n      } else if (revealed[cell]) {\r\n         revealUnflaggedNeighbors(cell);\r\n      } else {\r\n         revealCell(cell);\r\n      }\r\n   }, [mines, revealed, flagged, adjacent, getGameState, getNeighbors, populateBoard]);\r\n\r\n   if (firstClick) {\r\n      handleCellClick(firstClick);\r\n      setFirstClick(null);\r\n   }\r\n\r\n   const flagCell = (cell: number) => {\r\n      let nextFlagged = flagged.slice();\r\n      nextFlagged[cell] = !nextFlagged[cell];\r\n      setFlagged(nextFlagged);\r\n   }\r\n\r\n   const handleCellRightClick = (event: SyntheticEvent, cell: number) => {\r\n      event.preventDefault();\r\n      if (getGameState() !== GameState.InProgress) return;\r\n\r\n      flagCell(cell);\r\n   };\r\n\r\n   return {\r\n      gridSize,\r\n      mineCount,\r\n      setMineCount,\r\n      board: { mines, revealed, flagged, adjacent },\r\n      resetBoard,\r\n      handleCellClick,\r\n      handleCellRightClick,\r\n      flagCell,\r\n      getGameState,\r\n   };\r\n}\r\n","import { useCallback, useState } from \"react\";\r\n\r\nexport function useGrid(initSize: number) {\r\n   const [gridSize, setGridSize] = useState(initSize);\r\n\r\n   const getNeighbors: (cellIndex: number) => number[] =\r\n      useCallback((cellIndex) => {\r\n         const indexToCoords: (index: number) => [number, number] =\r\n            index => [index % gridSize, Math.floor(index / gridSize)];\r\n\r\n         const coordsToIndex: ([x, y]: [number, number]) => number =\r\n            ([x, y]) => y * gridSize + x;\r\n\r\n         const isInBounds = ([x, y]: [number, number]) =>\r\n            x >= 0 && x < gridSize && y >= 0 && y < gridSize;\r\n\r\n         const [x, y] = indexToCoords(cellIndex);\r\n         const neighbors: [number, number][] = [\r\n            [x - 1, y - 1], [x, y - 1], [x + 1, y - 1],\r\n            [x - 1, y], /* ~center point~ */[x + 1, y],\r\n            [x - 1, y + 1], [x, y + 1], [x + 1, y + 1],\r\n         ];\r\n\r\n         return neighbors\r\n            .filter(isInBounds)\r\n            .map(coordsToIndex);\r\n      }, [gridSize]);\r\n\r\n   return {\r\n      gridSize,\r\n      setGridSize,\r\n      getNeighbors\r\n   };\r\n}","import React, { useState, FormEvent } from \"react\";\r\nimport { GameState } from \"src/hooks/game\"\r\n\r\ntype GameStatusProps = {\r\n   gameState: GameState,\r\n   minesLeft: number,\r\n}\r\n\r\nfunction GameStatus({ gameState, minesLeft }: GameStatusProps) {\r\n   let status;\r\n   switch (gameState) {\r\n      case GameState.InProgress:\r\n         status = \"Flags left: \" + minesLeft;\r\n         break;\r\n      case GameState.Won:\r\n         status = \"You won!\"\r\n         break;\r\n      case GameState.Lost:\r\n         status = \"You lost :(\"\r\n         break;\r\n   }\r\n\r\n   return <h2>{status}</h2>;\r\n}\r\n\r\ntype ControlPanelProps = {\r\n   gridSize: number,\r\n   mineCount: number,\r\n   onSettingsUpdate: (gridSize: number, mineCount: number) => void\r\n} & GameStatusProps;\r\n\r\nexport function ControlPanel(props: ControlPanelProps) {\r\n   const [gridSize, setGridSize] = useState(props.gridSize);\r\n   const [mineCount, setMineCount] = useState(props.mineCount);\r\n   const [settingsChanged, setSettingsChanged] = useState(false);\r\n\r\n   const handleGridSizeChange = (event: FormEvent<HTMLInputElement>) => {\r\n      setGridSize(+event.currentTarget.value);\r\n      setSettingsChanged(true);\r\n   };\r\n\r\n   const handleMineCountChange = (event: FormEvent<HTMLInputElement>) => {\r\n      setMineCount(+event.currentTarget.value);\r\n      setSettingsChanged(true);\r\n   }\r\n\r\n   const handleSubmit = (event: FormEvent<HTMLFormElement>) => {\r\n      event.preventDefault();\r\n      props.onSettingsUpdate(gridSize, mineCount);\r\n      setSettingsChanged(false);\r\n   }\r\n\r\n   return (\r\n      <div className=\"control-panel\">\r\n         <h1>MINEKONG</h1>\r\n\r\n         <GameStatus gameState={props.gameState} minesLeft={props.minesLeft} />\r\n\r\n         <form onSubmit={handleSubmit} autoComplete=\"off\">\r\n            <label>\r\n               Grid size\r\n               <input name=\"gridSize\" type=\"text\" value={gridSize} onChange={handleGridSizeChange} />\r\n            </label>\r\n\r\n            <label>\r\n               Mine count\r\n               <input name=\"mineCount\" type=\"text\" value={mineCount} onChange={handleMineCountChange} />\r\n            </label>\r\n            <button type=\"submit\">{settingsChanged ? \"Apply and restart\" : \"Restart\"}</button>\r\n         </form>\r\n\r\n         <div className=\"rules\">\r\n            <div>\r\n               <h2>Rules</h2>\r\n               <p>A board contains a number of cells. Each cell can be either empty or a mine.</p>\r\n               <p>The goal of the game is to flag all the mines and reveal all the empty cells.</p>\r\n               <p>If you reveal a mine, it's game over!</p>\r\n               <p>Empty cells show a number of mines that reside in the 8 adjacent cells.</p>\r\n            </div>\r\n\r\n            <div>\r\n               <h2>Controls</h2>\r\n               <p><strong>Left click</strong> on an unrevealed cell to reveal it.</p>\r\n               <p><strong>Right click</strong> on an unrevealed cell to flag it as a mine.</p>\r\n\r\n               <p><strong>Tip #1:</strong> If you've placed enough flags near a revealed cell, you can click on it to automatically reveal cells without flags.</p>\r\n               <p><strong>Tip #2:</strong> The first cell you click will never be a mine, so don't worry about where to click.</p>\r\n            </div>\r\n         </div>\r\n      </div>\r\n   );\r\n}","import React, { ReactEventHandler, ReactNode } from \"react\";\r\n\r\ntype CellProps = {\r\n   isRevealed: boolean,\r\n   onClick: ReactEventHandler\r\n   onRightClick: ReactEventHandler\r\n   children: ReactNode\r\n};\r\n\r\nfunction Cell({ isRevealed, onClick, onRightClick, children }: CellProps) {\r\n   let className = \"cell\";\r\n   if (isRevealed) className += \" cell-revealed\";\r\n\r\n   return (\r\n      <button\r\n         className={className}\r\n         onClick={onClick}\r\n         onContextMenu={onRightClick}\r\n      >\r\n         {children}\r\n      </button>\r\n   );\r\n}\r\n\r\ntype CellHiddenProps = {\r\n   isFlagged: boolean,\r\n   onClick: ReactEventHandler,\r\n   onRightClick: ReactEventHandler,\r\n};\r\n\r\nfunction CellHidden({ isFlagged, onClick, onRightClick }: CellHiddenProps) {\r\n   return (\r\n      <Cell\r\n         isRevealed={false}\r\n         onClick={onClick}\r\n         onRightClick={onRightClick}\r\n      >\r\n         {isFlagged && \"🚩\"}\r\n      </Cell>\r\n   );\r\n}\r\n\r\ntype CellRevealedProps = {\r\n   isMine: boolean,\r\n   adjacentCount: number | null,\r\n   onClick: ReactEventHandler,\r\n};\r\n\r\nfunction CellRevealed({ isMine, adjacentCount, onClick }: CellRevealedProps) {\r\n   const countColors = [undefined, \"blue\", \"green\", \"red\", \"purple\", \"maroon\", \"turquoise\", \"black\", \"gray\"];\r\n\r\n   return (\r\n      <Cell\r\n         isRevealed={true}\r\n         onClick={onClick}\r\n         onRightClick={(e) => e.preventDefault()}\r\n      >\r\n         {isMine && \"💣\"}\r\n         {adjacentCount !== null && adjacentCount > 0 &&\r\n            <span style={{ color: countColors[adjacentCount] }}>{adjacentCount}</span>\r\n         }\r\n      </Cell>\r\n   );\r\n};\r\n\r\nexport { CellHidden, CellRevealed };","import React, { SyntheticEvent } from \"react\";\r\nimport { CellHidden, CellRevealed } from \"src/components/cell\";\r\nimport { range } from \"src/util\";\r\nimport { BoardState } from \"src/hooks/game\";\r\n\r\ntype RenderCellProps = {\r\n   board: BoardState,\r\n   onClick: (i: number) => void,\r\n   onRightClick: (e: SyntheticEvent, i: number) => void,\r\n};\r\n\r\nfunction renderCell(props: RenderCellProps, cellId: number) {\r\n   const {\r\n      board: { mines, flagged, revealed, adjacent },\r\n      onClick, onRightClick\r\n   } = props;\r\n\r\n   if (revealed[cellId]) {\r\n      return (\r\n         <CellRevealed\r\n            key={cellId}\r\n            isMine={mines[cellId]}\r\n            onClick={() => onClick(cellId)}\r\n            adjacentCount={adjacent[cellId]}\r\n         />\r\n      );\r\n   } else {\r\n      return (\r\n         <CellHidden\r\n            key={cellId}\r\n            isFlagged={flagged[cellId]}\r\n            onClick={() => onClick(cellId)}\r\n            onRightClick={(e) => onRightClick(e, cellId)}\r\n         />\r\n      );\r\n   }\r\n}\r\n\r\ntype BoardProps = { size: number } & RenderCellProps;\r\n\r\nexport function Board({ size, ...props }: BoardProps) {\r\n   let cellIds = range(0, size * size);\r\n   let rowIds = range(0, size);\r\n\r\n   let rows = rowIds.map(rowId =>\r\n      <div className=\"board-row\" key={rowId}>\r\n         {\r\n            cellIds\r\n               .slice(rowId * size, (rowId + 1) * size) // get cells in the row\r\n               .map(cellId => renderCell(props, cellId))\r\n         }\r\n      </div>\r\n   );\r\n\r\n   return <div className=\"board\">{rows}</div>;\r\n}","import React from \"react\";\r\nimport { useCookies } from \"react-cookie\";\r\nimport \"src/util\"\r\nimport { ControlPanel } from \"src/components/controlpanel\";\r\nimport { Board } from \"src/components/board\";\r\nimport { useGame } from \"src/hooks/game\"\r\nimport { resolveSoa } from \"dns\";\r\n\r\nexport function Game() {\r\n   const [cookies, setCookie] = useCookies([\"minekong\"]);\r\n\r\n   const initSize = cookies.size ?? 9;\r\n   const initMineCount = cookies.mineCount ?? 10;\r\n\r\n   const {\r\n      gridSize,\r\n      mineCount,\r\n      board,\r\n      resetBoard,\r\n      handleCellClick,\r\n      handleCellRightClick,\r\n      getGameState\r\n   } = useGame({ initSize, initMineCount });\r\n\r\n   const handleSettingsUpdate = (newGridSize: number, newMineCount: number) => {\r\n      setCookie('size', newGridSize);\r\n      setCookie('mineCount', newMineCount);\r\n      resetBoard(newGridSize, newMineCount);\r\n   }\r\n\r\n   return (\r\n      <div className=\"game\" onContextMenu={(e) => e.preventDefault()}>\r\n         <ControlPanel\r\n            gridSize={gridSize}\r\n            mineCount={mineCount}\r\n            gameState={getGameState()}\r\n            minesLeft={mineCount - board.flagged.countBy(Boolean)}\r\n            onSettingsUpdate={handleSettingsUpdate}\r\n         />\r\n\r\n         <Board\r\n            size={gridSize}\r\n            board={board}\r\n            onClick={handleCellClick}\r\n            onRightClick={handleCellRightClick}\r\n         />\r\n      </div>\r\n   );\r\n}","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport \"src/index.css\";\r\n\r\nimport { CookiesProvider } from 'react-cookie';\r\n\r\nimport { Game } from \"src/components/game\";\r\n\r\nfunction Root() {\r\n   return (\r\n      <CookiesProvider>\r\n         <Game />\r\n      </CookiesProvider>\r\n   );\r\n}\r\n\r\nReactDOM.render(\r\n   <Root />,\r\n   document.getElementById(\"root\")\r\n)"],"sourceRoot":""}